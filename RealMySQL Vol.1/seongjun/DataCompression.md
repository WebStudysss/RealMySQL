디스크에 저장된 데이터 파일의 크기는 쿼리의 처리 성능과도 직결되지만, 백업 및 복구 시간과도 밀접하게 연결된다.

파일이 클수록 쿼리를 처리하기 위해 더 많은 데이터 페이지를 InnoDB 버퍼 풀로 읽어야 할 수도 있고, 새로운 페이지가 버퍼 풀로 적재되기 때문에 그만큼 더티 페이지가 더 자주 디스크로 기록돼야 한다.

DBMS가 이런 문제점을 해결하기 위해 데이터 압축 기능을 제공한다.<br>압축 방식은 크게<br> 1)테이블 <br>2)페이지<br>로 구분되어 있다.

## 페이지 압축
버퍼 풀에 데이터 페이지가 한 번 적재되면 InnoDB스토리지 엔진은 압축이 해제된 상태로만 데이터 페이지를 관리한다.<br> 내부 코드에서는 압축 여부와 관계없이 "투명"하게 작동한다.<br> 페이지 압축 기능은 펀치 홀이라는 기능을 사용한다.<br>
그런데 문제는 펀치 홀 기능은 OS뿐만 아니라 HW 자체에서도 지원해야 사용 가능하다는 것이다.<br> 
이런 이유로 실제 페이지 압축은 많이 사용되지 않는 상태다.

## 테이블 압축
디스크의 데이터 파일 크기를 줄일 수 있기 때문에 그만큼의 이득은 있다.<br>
But 단점도 있다.
1. 버퍼 풀 공간 활용률이 낮음
2. 쿼리 처리 성능이 낮음
3. 빈번한 데이터 변경 시 압축률이 떨어짐

### 압축테이블 생성
전제 조건으로 압축을 사용하려는 테이블이 별도의 테이블 스페이스를 사용해야 한다.<br> ROW_FORMAT=COMPRESSED 옵션을 명시해야한다. <br>
추가로 타깃 크기를 명시하는데 **<i>2n</i>**으로만 설정할 수 있다.<br>
InnoDB 스토리지 엔진의 페이지 크기가 16KB면,KEY_BLOCK_SIZE는 4KB 또는 8KB만 설정가능.

### KEY_BLOCK_SIZE 결정
테이블 압축을 적용하기 전에 먼저 KEY_BLOCK_SIZE를 4 또는 8KB로 테이블을 생성해서 샘플 데이터를 저장해보고 적절한지 판단하는 것이 좋다. PK는 압축 실패율은 3~5% 미만으로 유지.<br>예상외로 압축 알고리즘은 많은 CPU 자원을 소모한다.

