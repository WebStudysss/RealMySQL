# 데이터 압축

MySQL에서는 데이터 압축이 가능하며, 크게 두 가지 압축 방식이 있음

- 페이지 압축
- 테이블 압축

## 페이지 압축

MySQL 서버가 디스크에 저장하는 시점에 데이터 페이지가 압축되어 저장되고, 페이지 블록마다 압축되고 남은 데이터를 펀치홀 기능을 사용해 남긴다.

ex) 16kb 블록 중 데이터가 압축되어 7kb로 변경되었다면, 9kb는 펀치홀로 활용 가능한 데이터 블록

허나 이는 운영체제 및 하드웨어에서 해당 기능을 지원해야 하기에 활용 가능성이 높지 않다.

## 테이블 압축

테이블 압축은 운영체제나 하드웨어에 대한 제약 없이 사용할 수 있기 때문에 활용도가 높다.
허나 하기 단점이 존재한다.

- 버퍼 풀 공간 활용률이 낮음
- 쿼리 처리 성능이 낮음
- 빈번한 데이터 변경 시 압축률이 떨어짐

## 압축 테이블 생성

innodb_file_per_table 시스템 변수 on 상태, 테이블 선언 시 `ROW_FORMAT=COMPRESSED, KEY_BLOCK_SIZE=N` 옵션을 넣어야 한다.

KEY_BLOCK_SIZE 의 값을 기준으로 압축하기 위해 InnoDB에서는 페이지 단위를 계속 스플릿 하며 압축하기 때문에, 값 설정을 잘해줘야 한다.

## 압축된 페이지의 버퍼 풀 적재 및 사용

압축된 페이지를 버퍼풀에 적재할 때 압축된 상태와 압축이 해제된 상태 2개 버전을 관리

- 기본 페이지 LRU 리스트
- Unzip_LRU 리스트

따라서, 압축된 페이지를 사용할 때는 버퍼풀이 이중 공간을 사용한다는 단점이 있다. 허나, 데이터를 매번 불러올 때마다 압축 페이지를 매번 압축해제 한다면 CPU의 부하가 심해 성능적인 단점이 더 크기에, 해당 방식을 적용하며, 적절한 크기를 InnoDB 스토리지 엔진 내부 알고리즘으로 선정해서 관리한다.
